<!doctype html>
<html>
<head>
    <title>Dymo Labelmanager PnP</title>
</head>
<body>
  <h2>Enter Text for the label</h2>
  <form method="post" id="labelForm" action="/">
    <textarea name="text_content" rows="2" style="width: 350px;" id="textContent"></textarea><br>
    <input type="hidden" name="submit_type" id="submitType" value="manual">
    <input type="submit" value="Print Label">
    <!-- Display the result here -->
    <div id="result">
        {{ result|safe }}
        <ul>
          <li>Label length:  <a id="label_length"></a></li>
          <li>Label Label will  <a id="label_fit"></a>fit <a href='https://www.conrad.de/de/p/tru-components-tc-mc1203-100-kabelmarkierer-montage-art-kabelbinder-beschriftungsflaeche-32-x-11-mm-natur-100-st-3013928.html'>cable tie</a></li>
          <li>Label Label will <a id="label_fit_cut"></a>fit <a href='https://www.conrad.de/de/p/tru-components-tc-mc1203-100-kabelmarkierer-montage-art-kabelbinder-beschriftungsflaeche-32-x-11-mm-natur-100-st-3013928.html'>cable tie</a> after cutting margin</li>
          <li><a id="error_msg" style="color:red" ></a></li>
        </ul>
    </div>
  </form>

  <!-- Button to add text to the textarea -->
  <button onclick="addTextToTextarea(this.textContent)">∞</button>
  <button onclick="addTextToTextarea(this.textContent)">↑</button>
  <button onclick="addTextToTextarea(this.textContent)">↓</button>
  <button onclick="addTextToTextarea(this.textContent)">←</button>
  <button onclick="addTextToTextarea(this.textContent)">→</button>

  <script>
    document.getElementById('textContent').addEventListener('input', function() {
        document.getElementById('submitType').value = 'automatic';
        submitForm();
    });

    document.getElementById('labelForm').addEventListener('submit', function(event) {
        event.preventDefault();
        document.getElementById('submitType').value = 'manual';
        submitForm();
    });

    function submitForm() {
        const form = document.getElementById('labelForm');
        const formData = new FormData(form);

        fetch(form.action, {
            method: form.method,
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('label_length').innerHTML = data.result.label_length + ' mm' || '0 mm';
            document.getElementById('label_fit').innerHTML = data.result.label_fit || '';
            document.getElementById('label_fit_cut').innerHTML = data.result.label_fit_cut || '';
            document.getElementById('error_msg').innerHTML = data.result.error_msg || '';
        })
        .catch(error => console.error('Error:', error));
    }
    // Function to add text to the textarea
    function addTextToTextarea(text) {
      document.getElementById('textContent').value += text;
  }
  </script>
</body>
</html>